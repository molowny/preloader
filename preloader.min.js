!function(e,o){"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o():e.preloader=o}(this,function(){"use strict";var e={};e.defaults={debug:!1,getFromCSS:!0,filesToLoad:[],allowed:["jpg","jpeg","png","gif"],loadDelay:0,beforeLoad:function(){},afterLoad:function(){},onUpdate:function(e){}},e.regex={files:/(href="(.*?)")|(src="(.*?)")|(url\((.*?)\))/g,junk:/(&quot;)|(')|(")/g,breaks:["2","4","6"]},e.html=String(document.querySelector("html").innerHTML),e.css=[];var o=[],n=function(o){try{i(),"object"==typeof o?e.options=t(o):e.options=e.defaults,e.options.filesToLoad.length?(e.filelist=function(){for(var o=[],n=e.options.filesToLoad.length-1;n>=0;n--)"image"===f(e.options.filesToLoad[n])&&o.push(e.options.filesToLoad[n]);if(o.length<=0&&e.options.debug)throw"Error: Badly defined custom filelist.";return o}(),s()):r(function(o){e.filelist=o.filter(function(e,n){return o.indexOf(e)==n}),s()})}catch(n){console.log(n)}},t=function(o){for(var n in o)if("undefined"!=typeof e.defaults[n])e.defaults[n]=o[n];else if(e.defaults.debug)throw"There's no option called: '"+n+"'";return e.defaults},i=function(){"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?e.promise=!0:e.promise=!1},r=function(o){for(var n=[];i=e.regex.files.exec(e.html);)for(var t in e.regex.breaks)if("undefined"!=typeof i[e.regex.breaks[t]]){var i=i[e.regex.breaks[t]].replace(e.regex.junk,"");"image"===f(i)?n.push(i):"css"===f(i)&&e.css.push(i)}if(e.options.getFromCSS)for(var r=[],t=e.css.length-1;t>=0;t--)!function(t){r[t]=new XMLHttpRequest,r[t].open("GET",e.css[t],!0),r[t].send(),r[t].onreadystatechange=function(){if(4==r[t].readyState&&200==r[t].status){for(;i=e.regex.files.exec(r[t].responseText);){var i=i[6].replace(e.regex.junk,"");"image"===f(i)&&n.push(i)}t||o(n)}}}(t);else o(n)},f=function(o){var n=/([^.;+_]+)$/.exec(o),t=n&&n[1];return e.options.allowed.indexOf(t)>-1?"image":t},s=function(){"function"==typeof e.options.beforeLoad&&e.options.beforeLoad(),a()},a=function(){var o=0;if(e.promise){var n=e.filelist.map(function(e){return l(e).then(function(){o++,u(o)},function(e){o++,u(o)})});Promise.all(n).then(function(){e.complete=!0,c()})}else{e.loadedImages=0,d();for(var t=e.filelist.length-1;t>=0;t--)l(e.filelist[t])}},l=function(o){if(e.promise)return new Promise(function(e,n){var t=new Image;t.src=o,t.onload=function(){e()},t.onerror=function(){n("Can't find: "+o)}});var n=new Image;n.src=o,n.onload=function(){e.loadedImages++,u(e.loadedImages)},n.onerror=function(){e.loadedImages++,u(e.loadedImages)}},u=function(o){var n=Number(parseFloat(o/e.filelist.length*100).toFixed(2));e.options.onUpdate(n)},d=function(){var o=setInterval(function(){e.loadedImages===e.filelist.length&&(e.complete=!0,c(),clearInterval(o))},50)},c=function(){setTimeout(function(){e.options.afterLoad();for(var n=o.length-1;n>=0;n--)o[n]()},e.options.loadDelay)},p=function(n){e.complete?n():"function"==typeof n&&o.push(n)};return{preloader:e,init:n,onLoad:p}}());
