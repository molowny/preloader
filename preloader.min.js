!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.preloader=b}(this,function(){"use strict";var a={};a.defaults={debug:!1,getFromCSS:!0,filesToLoad:[],allowed:["jpg","jpeg","png","gif"],loadDelay:0,beforeLoad:function(){},afterLoad:function(){},onUpdate:function(){}},a.regex={files:/(href="(.*?)")|(src="(.*?)")|(url\((.*?)\))/g,junk:/(&quot;)|(')|(")/g,breaks:["2","4","6"]},a.html=String(document.querySelector("html").innerHTML),a.css=[];var b=[],c=function(b){try{e(),a.options="object"==typeof b?d(b):a.defaults,a.options.debug&&console.time("Preloader"),a.options.filesToLoad.length?(a.filelist=function(){for(var b=[],c=a.options.filesToLoad.length-1;c>=0;c--)"image"===g(a.options.filesToLoad[c])&&b.push(a.options.filesToLoad[c]);if(0===b.length&&a.options.debug)throw"Wrong defined images format.";return b}(),h()):f(function(b){a.filelist=b.filter(function(a,c){return b.indexOf(a)==c}),h()})}catch(c){console.log(c)}},d=function(b){for(var c in b)"undefined"!=typeof a.defaults[c]&&(a.defaults[c]=b[c]);return a.defaults},e=function(){a.promise="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?!0:!1},f=function(b){for(var c=[];e=a.regex.files.exec(a.html);)for(var d in a.regex.breaks)if("undefined"!=typeof e[a.regex.breaks[d]]){var e=e[a.regex.breaks[d]].replace(a.regex.junk,"");"image"===g(e)?c.push(e):"css"===g(e)&&a.css.push(e)}if(a.options.getFromCSS)for(var f=[],d=a.css.length-1;d>=0;d--)!function(d){f[d]=new XMLHttpRequest,f[d].open("GET",a.css[d],!0),f[d].send(),f[d].onreadystatechange=function(){if(4==f[d].readyState&&200==f[d].status){for(;e=a.regex.files.exec(f[d].responseText);){var e=e[6].replace(a.regex.junk,"");"image"===g(e)&&c.push(e)}d||b(c)}}}(d);else b(c)},g=function(b){var c=/([^.;+_]+)$/.exec(b),d=c&&c[1];return a.options.allowed.indexOf(d)>-1?"image":d},h=function(){"function"==typeof a.options.beforeLoad&&a.options.beforeLoad(),i()},i=function(){var c=0;if(a.promise){var e=a.filelist.map(function(b){return j(b).then(function(b){c++,k(c),a.options.debug&&console.log(b.src)},function(b){c++,k(c),a.options.debug&&console.log("No image: "+b.src)})});Promise.all(e).then(function(){a.complete=!0,m()})}else{a.loadedImages=0,l();for(var f=a.filelist.length-1;f>=0;f--)j(a.filelist[f])}},j=function(b){if(a.promise)return new Promise(function(a,c){var d=new Image;d.src=b,d.onload=function(){a(d)},d.onerror=function(){c(d)}});var c=new Image;c.src=b,c.onload=function(){a.loadedImages++,k(a.loadedImages),a.options.debug&&console.log(c.src)},c.onerror=function(){a.loadedImages++,k(a.loadedImages),a.options.debug&&console.log("No image: "+c.src)}},k=function(b){var c=Number(parseFloat(100*(b/a.filelist.length)).toFixed(2));a.options.onUpdate(c)},l=function(){var b=setInterval(function(){a.loadedImages===a.filelist.length&&(a.complete=!0,m(),clearInterval(b))},50)},m=function(){setTimeout(function(){a.options.afterLoad();for(var c=b.length-1;c>=0;c--)b[c]()},a.options.loadDelay),a.options.debug&&console.timeEnd("Preloader")},n=function(c){a.complete?c():"function"==typeof c&&b.push(c)};return{preloader:a,init:c,onLoad:n}}());
